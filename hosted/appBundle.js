(()=>{"use strict";const e=(e,t,n)=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":t._csrf},body:JSON.stringify(t)}).then((e=>a(e,n))),t=(e,t)=>fetch(e,{method:"GET",headers:{Accept:"application/json"}}).then((e=>a(e,t))),a=(e,t)=>e.ok?e.json():t(e.json()),n=e=>e.leaderboard?e.leaderboard.length<=0?React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("h4",{className:"one-half column"},"Leaderboard"),React.createElement("select",{id:"filterDropdown",onChange:c},React.createElement("option",{value:"unset"},"All"),React.createElement("option",{value:"Alpine"},"Alpine"),React.createElement("option",{value:"Mountain"},"Mountain"))),React.createElement("p",null,"This leaderboard has no records to show!")):React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("h4",{className:"one-half column"},"Leaderboard"),React.createElement("select",{id:"filterDropdown",onChange:c},React.createElement("option",{value:"unset"},"All"),React.createElement("option",{value:"Alpine"},"Alpine"),React.createElement("option",{value:"Mountain"},"Mountain"))),React.createElement("table",{className:"u-full-width"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Name"),React.createElement("th",null,"Type"),React.createElement("th",null,"Score"))),React.createElement("tbody",null,e.leaderboard.map((e=>React.createElement("tr",{key:e._id},React.createElement("td",null,e.name),React.createElement("td",null,e.type),React.createElement("td",null,e.score))))))):React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("h4",{className:"one-half column"},"Leaderboard"),React.createElement("select",{id:"filterDropdown",onChange:c},React.createElement("option",{value:"unset"},"All"),React.createElement("option",{value:"Alpine"},"Alpine"),React.createElement("option",{value:"Mountain"},"Mountain"))),React.createElement("p",null,"No leaderboards to show!")),c=e=>{const a="/leaderboard"+("unset"!=e.target.value?"?filter="+e.target.value:"");t(a).then((e=>{ReactDOM.render(React.createElement(n,{leaderboard:e.leaderboard}),document.querySelector("#content"))}))};let l,r,s;const o=e=>React.createElement("div",{className:"container"},React.createElement("h4",null,e.profile.username),React.createElement("h5",null,"Avatar: ",r?r.name:"Default",r?React.createElement("img",{src:"/assets/img/"+r.type+r.path+"/icon.png"}):""),React.createElement("h5",null,"Terrain Pack: ",s?s.name:"Default",s?React.createElement("img",{src:"/assets/img/"+s.type+s.path+"/icon.png"}):""),React.createElement("h5",null,"Owned Items"),React.createElement("div",{className:"u-full-width",id:"marketItems"})),i=e=>!e.profile.ownedItems||e.profile.ownedItems<=0?React.createElement("div",null,React.createElement("p",null,"There are no items to show!")):e.profile.ownedItems.map((t=>React.createElement("div",{className:"marketItem",key:t._id},React.createElement("div",{className:"container"},React.createElement("img",{src:"/assets/img/"+t.type+t.path+"/icon.png"}),React.createElement("h5",null,t.name),m(e,t))))),m=(t,a)=>a._id===l.equipedAvatar||a._id===l.equipedTerrain?React.createElement("button",{type:"button",className:"button"},"Equiped"):React.createElement("button",{type:"button",className:"button-primary",onClick:async n=>{await e("/equipItem",{id:a._id,type:a.type,_csrf:t.csrf}),u()}},"Equip"),d=async()=>{const e=await t("/getProfile");return l=e.profile,l.ownedItems.push({_id:"defaultavatar",name:"Default Avatar",type:"avatar",path:"/default"}),l.ownedItems.push({_id:"defaultterrain",name:"Default Terrain",type:"terrain",path:"/default"}),r=l.ownedItems.find((e=>e._id===l.equipedAvatar)),s=l.ownedItems.find((e=>e._id===l.equipedTerrain)),l},u=async()=>{await d();const e=await t("/getToken").then((e=>e.csrfToken));ReactDOM.render(React.createElement(o,{profile:l}),document.querySelector("#content")),ReactDOM.render(React.createElement(i,{profile:l,csrf:e}),document.querySelector("#marketItems"))},h=e=>React.createElement("div",{className:"container"},React.createElement("div",{className:"row"},React.createElement("h4",{className:"one-half column"},"Ski Shop"),React.createElement("select",{id:"filterDropdown",onChange:t=>{E(t.target.value,e.csrf)}},React.createElement("option",{value:"unset"},"All"),React.createElement("option",{value:"terrain"},"Terrain Packs"),React.createElement("option",{value:"avatar"},"Avatars"))),React.createElement("div",{className:"u-full-width",id:"marketItems"})),R=e=>!e.market||e.market.length<=0?React.createElement("p",null,"Nothing was found in the Ski Shop!"):e.market.map((t=>React.createElement("div",{className:"marketItem",key:t._id},React.createElement("div",{className:"container"},React.createElement("img",{src:"/assets/img/"+t.type+t.path+"/icon.png"}),React.createElement("h5",null,t.name),p(e,t))))),p=(t,a)=>{let n=(e=>l.ownedItems.find((t=>t._id===e._id)))(a);return n?React.createElement("button",{type:"button",className:"button"},"Owned"):React.createElement("button",{type:"button",className:"button-primary",onClick:async n=>{await e("/buyItem",{id:a._id,_csrf:t.csrf}),E("unset",t.csrf)}},"Buy")},E=(e,a)=>{const n="/market"+("unset"!=e?"?filter="+e:"");console.dir("update"),t(n).then((async e=>{await d(),ReactDOM.render(React.createElement(R,{market:e.market,csrf:a}),document.querySelector("#marketItems"))}))};let y,v,f,w=0,b=0,g=10;const k=(e,t)=>{let a=e-w,n=t-b;return a=a/g*v,n=y.height-n/g*v,{x:a,y:n}},N={},x=e=>{N[e.key]=!0},S=e=>{N[e.key]=!1},T=e=>N[e];class q{constructor(e,t,a){this.x=e,this.y=t,this.avatar=a,this.movementSpeed=1,this.vx=0,this.vy=0,this.facingX=0,this.facingY=0}update(e){T("w")&&(this.vy+=this.movementSpeed),T("a")&&(this.vx+=-this.movementSpeed),T("s")&&(this.vy+=-this.movementSpeed),T("d")&&(this.vx+=this.movementSpeed),0!=this.vx&&(this.vx-=.3*this.vx),0!=this.vy&&(this.vy-=.3*this.vy),0==this.vx&&0==this.vy||(this.facingX=this.vx,this.facingY=this.vy),this.x+=this.vx*e,this.y+=this.vy*e}draw(e){const t=k(this.x,this.y),a=Math.atan2(this.facingX,this.facingY);e.save(),e.translate(t.x+f/2,t.y+f/2),e.rotate(a),e.translate(-(t.x+f/2),-(t.y+f/2)),e.drawImage(this.avatar,t.x,t.y,f,f),e.restore()}}const M=(e,t)=>{const a=((e,t)=>Math.sqrt(e*e+t*t))(e,t);return{x:e/a,y:t/a}};class I{constructor(e,t){this.seed=e,this.spritesheet=t,this.chunks=[new O(0,0,0,t),new O(-16,0,0,t),new O(0,-16,0,t),new O(-16,-16,0,t)]}update(e){}draw(e){this.chunks.forEach((t=>{t.draw(e)}))}}class O{constructor(e,t,a,n){this.x=e,this.y=t,this.spritesheet=n,this.tiles=[];for(let e=0;e<16;e++)for(let t=0;t<16;t++){let a=16*t+e,n=this.x+e,c=this.y+t,l=this.altitude(n,c),r={x:-n,y:-c};r=M(r.x,r.y),this.tiles[a]=new C(n,c,l,this.spritesheet,r)}}draw(e){this.tiles.forEach((t=>{t.draw(e)}))}altitude(e,t){return a=e,n=t,0,0,Math.sqrt(Math.pow(0-a,2)+Math.pow(0-n,2));var a,n}}class C{constructor(e,t,a,n,c){this.x=e,this.y=t,this.z=a,this.img=n,this.facing=c,this.sx=0,this.sy=0}draw(e){const t=k(this.x,this.y),a=k(this.x+this.facing.x,this.y+this.facing.y);e.save();const n={x:16,y:16};this.facing.x>0&&(n.x-=16),this.facing.x<0&&(n.x+=16),this.facing.y>0&&(n.y+=16),this.facing.y<0&&(n.y-=16),e.drawImage(this.img,n.x,n.y,16,16,t.x,t.y,f,f),e.strokeStyle="black",e.beginPath(),e.moveTo(t.x+f/2,t.y+f/2),e.lineTo(a.x+f/2,a.y+f/2),e.rect(a.x+f/2-7.5,a.y+f/2-7.5,15,15),e.closePath(),e.stroke(),e.restore()}}let D,_,A,P,B,$={width:600,height:600},j={};const F=e=>React.createElement("canvas",null,"Canvas needs to be supported!"),L=async()=>{ReactDOM.render(React.createElement(F,null),document.querySelector("#content")),document.onkeydown=x,document.onkeyup=S;let e=await(async()=>(l||await d(),r))(),t=await(async()=>(l||await d(),s))();var a;j[e._id]=new Image,j[e._id].src=`/assets/img/avatar${e.path}/sprite.png`,A=new Image,A.src=`/assets/img/terrain${t.path}/spritesheet.png`,D=document.querySelector("canvas"),D.width=$.width,D.height=$.height,y=a=$,g=10,v=a.width,f=v/10,_=D.getContext("2d"),_.imageSmoothingEnabled=!1,_.mozImageSmoothingEnabled=!1,_.webkitImageSmoothingEnabled=!1,_.msImageSmoothingEnabled=!1,P=new q(0,0,j[e._id]),B=new I(0,A),X()},X=()=>{requestAnimationFrame(X),_.clearRect(0,0,$.width,$.height);for(let e=0;e<10;e++)for(let t=0;t<10;t++){_.save(),_.translate(0,-f),_.fillStyle=`rgb(${e/10*255}, ${t/10*255}, ${(e/10+t/10)/2*255})`;const a=k(e,t);_.fillRect(a.x,a.y,f,f),_.restore()}var e,t;P.update(.016666666666666666),e=P.x-4.5,t=P.y-5.5,w=e,b=t,B.draw(_),P.draw(_)},J=e=>React.createElement("div",{className:"container"},React.createElement("div",{className:"row",id:"headerBar"},React.createElement("button",{type:"button",className:"button",id:"marketButton",onClick:()=>{console.dir("clicked market"),(async()=>{ReactDOM.render(React.createElement(h,null),document.querySelector("#content"));const e=await t("/getToken").then((e=>e.csrfToken)),a=await t("/market");await d(),ReactDOM.render(React.createElement(h,{csrf:e}),document.querySelector("#content")),ReactDOM.render(React.createElement(R,{market:a.market,csrf:e}),document.querySelector("#marketItems"))})()}},"Market"),React.createElement("button",{type:"button",className:"button",id:"leaderboardButton",onClick:()=>{console.dir("clicked leaderboard"),ReactDOM.render(React.createElement(n,null),document.querySelector("#content")),t("/leaderboard").then((e=>{ReactDOM.render(React.createElement(n,{leaderboard:e.leaderboard}),document.querySelector("#content"))}))}},"Leaderboards"),React.createElement("button",{type:"button",className:"button",id:"gameButton",onClick:()=>{console.dir("clicked game"),K()}},"Game"),React.createElement("button",{type:"button",className:"button",id:"profileButton",onClick:()=>{console.dir("clicked profile"),u()}},"Profile"))),Y=e=>!e.slopes||e.slopes.length<=0?React.createElement("div",{className:"u-full-width"},React.createElement("div",{className:"row"},React.createElement("h4",{className:"one-half column"},"Open Resorts"),React.createElement("div",{className:"one-half column"},React.createElement("a",{className:"button",onClick:H},"Refresh"))),React.createElement("table",{className:"u-full-width"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Resort Name"),React.createElement("th",null,"Terrain Type"),React.createElement("th",null,"Skiier Count"),React.createElement("th",null,React.createElement("a",{className:"button button-primary",onClick:G},"Open Resort")))),React.createElement("tbody",null,React.createElement("tr",null,React.createElement("td",null,"No open resorts!"),React.createElement("td",null),React.createElement("td",null),React.createElement("td",null))))):React.createElement("div",null,React.createElement("div",{className:"row"},React.createElement("h4",{className:"one-half column"},"Open Resorts"),React.createElement("div",{className:"one-half column"},React.createElement("a",{className:"button",onClick:H},"Refresh"))),React.createElement("table",{className:"u-full-width"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Resort Name"),React.createElement("th",null,"Terrain Type"),React.createElement("th",null,"Skiier Count"),React.createElement("th",null,React.createElement("button",{type:"button",className:"button-primary",onClick:G},"Open Resort")))),React.createElement("tbody",null,e.slopes.map((e=>React.createElement("tr",{key:e.id},React.createElement("td",null,e.name),React.createElement("td",null,e.type),React.createElement("td",null,e.playerCount),React.createElement("td",null,React.createElement("button",{type:"button",className:"button",onClick:async()=>{console.dir("Join slope: "+e.name),await t("/getSlope?id="+e.id),L()}},"Join Slope")))))))),z=t=>React.createElement("div",{className:"u-full-width"},React.createElement("h4",null,"Open Resort"),React.createElement("label",{htmlFor:"resortName"},"Resort Name:"),React.createElement("input",{type:"text",id:"resortName",placeholder:"Enter resort name here..."}),React.createElement("label",{htmlFor:"resortType"},"Resort Type:"),React.createElement("select",{id:"resortType"},React.createElement("option",{value:"alpine"},"Alpine"),React.createElement("option",{value:"mountain"},"Mountain")),React.createElement("button",{className:"button-primary",onClick:async()=>{const a={name:document.querySelector("#resortName").value,type:document.querySelector("#resortType").value,_csrf:t.csrf},n=await e("/createResort",a);console.dir(n),L()}},"Open Resort!")),G=async()=>{const e=await t("/getToken").then((e=>e.csrfToken));ReactDOM.render(React.createElement(z,{csrf:e}),document.querySelector("#content"))},H=()=>{ReactDOM.render(React.createElement(Y,null),document.querySelector("#content")),t("/slopes").then((e=>{ReactDOM.render(React.createElement(Y,{slopes:e.slopes}),document.querySelector("#content"))}))},K=()=>{ReactDOM.render(React.createElement(J,null),document.querySelector("#header")),H()};window.onload=()=>{K()}})();